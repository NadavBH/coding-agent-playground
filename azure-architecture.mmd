graph TB
    subgraph Users["ğŸ‘¥ End Users - EU/Global"]
        direction LR
        EU["ğŸŒ European Users<br/>(Primary Audience)"]
    end

    subgraph CDN["ğŸ“¡ Content Delivery Network"]
        direction LR
        ACDN["Azure CDN<br/>Edge Locations<br/>Static Content Cache"]
    end

    subgraph Security["ğŸ›¡ï¸ Gateway & Security Layer"]
        direction LR
        AppGW["Application Gateway<br/>Standard v2<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ SSL/TLS Termination<br/>âœ“ Web Application Firewall<br/>âœ“ Rate Limiting<br/>âœ“ Path-based Routing"]
        TM["Traffic Manager<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ Geographic Routing<br/>âœ“ Failover<br/>âœ“ Load Balancing"]
    end

    subgraph Network["ğŸ”— Virtual Network"]
        direction TB
        VNet["Virtual Network<br/>10.0.0.0/16"]
        AppSubnet["App Subnet<br/>10.0.1.0/24<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>App Service<br/>NSG Rules"]
        DBSubnet["DB Subnet<br/>10.0.2.0/24<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>SQL Database<br/>Private Access"]
    end

    subgraph Compute["âš™ï¸ Application Layer - COMPUTE"]
        direction TB
        AppSvc1["App Service - Sweden Central<br/>Tier: B2/B3 (Auto-Scale)<br/>Runtime: Node.js<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ Contoso Toyland API<br/>âœ“ Product Management<br/>âœ“ Shopping Cart Backend<br/>âœ“ Admin Functions"]
        AppSvc2["App Service - Failover<br/>North Europe<br/>(Future Deployment)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Secondary Region<br/>Hot Standby"]
    end

    subgraph Data["ğŸ—„ï¸ Data Layer - STORAGE & DATABASE"]
        direction TB
        SQL["Azure SQL Database<br/>Server: contoso-toyland-db<br/>Tier: Standard S1<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ Toys Table<br/>âœ“ Users Table<br/>âœ“ Orders Table (Future)<br/>âœ“ Encryption: TDE<br/>âœ“ Backups: Daily<br/>âœ“ Read Replicas: Enabled"]
        Storage["Azure Storage Account<br/>Standard LRS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ Backup Blobs<br/>âœ“ Audit Logs<br/>âœ“ File Uploads<br/>âœ“ Configuration"]
    end

    subgraph Secrets["ğŸ” Security & Secrets Management"]
        direction TB
        KV["Azure Key Vault<br/>Standard Tier<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Stored Secrets:<br/>âœ“ DB Connection String<br/>âœ“ API Keys<br/>âœ“ Admin Credentials<br/>âœ“ JWT Signing Keys<br/>âœ“ SSL Certificates<br/><br/>Features:<br/>âœ“ RBAC Access Control<br/>âœ“ Audit Logging<br/>âœ“ Soft-Delete (90 days)<br/>âœ“ Purge Protection"]
    end

    subgraph Backup["ğŸ’¾ Disaster Recovery & Backup"]
        direction TB
        AzBackup["Azure Backup Vault<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Database Backups:<br/>âœ“ Frequency: Daily<br/>âœ“ Retention: 35 days<br/>âœ“ Geo-Redundant: YES<br/>âœ“ Secondary: Netherlands<br/><br/>RTO: 4 hours<br/>RPO: 1 hour<br/><br/>Point-in-Time Restore:<br/>Any moment last 35 days"]
    end

    subgraph Monitoring["ğŸ“Š Monitoring & Observability"]
        direction TB
        AppIns["Application Insights<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Real-Time Monitoring:<br/>âœ“ Request Tracking<br/>âœ“ Performance Metrics<br/>âœ“ Exception Logging<br/>âœ“ Custom Events<br/>âœ“ User Analytics<br/>âœ“ Smart Alerts<br/><br/>Tracks:<br/>âœ“ API Response Times<br/>âœ“ Error Rates<br/>âœ“ Cart Transactions<br/>âœ“ Admin Activities"]
        LogAnalytics["Log Analytics Workspace<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Centralized Logging:<br/>âœ“ App Logs<br/>âœ“ SQL Audit Logs<br/>âœ“ Key Vault Access<br/>âœ“ NSG Flow Logs<br/>âœ“ Compliance Reports<br/><br/>5GB/month: FREE"]
    end

    subgraph Alerts["ğŸš¨ Alerting & Notifications"]
        direction TB
        AlertRules["Alert Rules<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Triggers:<br/>âœ“ Failed Requests > 5%<br/>âœ“ Response Time > 2s<br/>âœ“ App CPU > 80%<br/>âœ“ Database DTU > 85%<br/>âœ“ Storage > 80%<br/>âœ“ Backup Failures<br/><br/>Actions:<br/>âœ“ Email Notifications<br/>âœ“ SMS Alerts<br/>âœ“ Auto-Remediation"]
    end

    %% Connections from Users
    EU -->|HTTPS| ACDN
    EU -->|Direct| AppGW
    
    %% CDN to Gateway
    ACDN -->|Static Content| AppGW
    
    %% Gateway to Traffic Manager
    AppGW -->|Route| TM
    
    %% Traffic Manager to App Services
    TM -->|Primary| AppSvc1
    TM -->|Failover| AppSvc2
    
    %% App Services to VNet
    AppSvc1 -->|Connected| VNet
    AppSvc2 -->|Connected| VNet
    VNet --> AppSubnet
    VNet --> DBSubnet
    
    %% App Services to Data Layer
    AppSvc1 -->|SQL Queries| SQL
    AppSvc1 -->|Store Logs| Storage
    
    %% Data Layer connections
    SQL -->|Backup| AzBackup
    Storage -->|Stores| AzBackup
    
    %% Security Layer
    AppSvc1 -.->|Retrieve Secrets| KV
    KV -->|Audit Logs| LogAnalytics
    
    %% Monitoring connections
    AppSvc1 -->|Send Metrics| AppIns
    SQL -->|Performance Data| AppIns
    AppGW -->|Traffic Stats| AppIns
    
    AppIns -->|Logs & Events| LogAnalytics
    LogAnalytics -->|Trigger| AlertRules
    
    %% Styling
    classDef userStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef cdnStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef securityStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef networkStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    classDef computeStyle fill:#e0f2f1,stroke:#00796b,stroke-width:2px,color:#000
    classDef dataStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    classDef secretsStyle fill:#ede7f6,stroke:#512da8,stroke-width:2px,color:#000
    classDef backupStyle fill:#e0f2f1,stroke:#00838f,stroke-width:2px,color:#000
    classDef monitorStyle fill:#f1f8e9,stroke:#558b2f,stroke-width:2px,color:#000
    classDef alertStyle fill:#fff8e1,stroke:#f57f17,stroke-width:2px,color:#000

    class Users userStyle
    class CDN cdnStyle
    class Security securityStyle
    class Network networkStyle
    class Compute computeStyle
    class Data dataStyle
    class Secrets secretsStyle
    class Backup backupStyle
    class Monitoring monitorStyle
    class Alerts alertStyle
